<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <h1>Motion Tracking Example</h1>
  <div id="acc">Accelerometer: —</div>
  <div id="orient">Orientation: —</div>
  <div id="gyro">Gyroscope: —</div>
  <button id="start">Start tracking</button>
  <button id="stop">Stop tracking</button>

  <script>
    const wasm = window.Telegram.WebApp;

    // Обработчики событий

    wasm.onEvent('accelerometerStarted', () => {
      console.log('Accelerometer started');
    });

    wasm.onEvent('accelerometerChanged', () => {
      const acc = wasm.Accelerometer;
      document.getElementById('acc').textContent = 
        `x: ${acc.x.toFixed(2)}, y: ${acc.y.toFixed(2)}, z: ${acc.z.toFixed(2)}`;
    });

    wasm.onEvent('accelerometerStopped', () => {
      console.log('Accelerometer stopped');
    });

    wasm.onEvent('accelerometerFailed', (e) => {
      console.error('Accelerometer failed', e.error);
    });

    // Ориентация устройства

    wasm.onEvent('deviceOrientationStarted', () => {
      console.log('DeviceOrientation started');
    });

    wasm.onEvent('deviceOrientationChanged', () => {
      const orientation = wasm.DeviceOrientation;
      document.getElementById('orient').textContent = 
        `alpha: ${orientation.alpha.toFixed(2)}, beta: ${orientation.beta.toFixed(2)}, gamma: ${orientation.gamma.toFixed(2)}, absolute: ${orientation.absolute}`;
    });

    wasm.onEvent('deviceOrientationStopped', () => {
      console.log('DeviceOrientation stopped');
    });

    wasm.onEvent('deviceOrientationFailed', (e) => {
      console.error('DeviceOrientation failed', e.error);
    });

    // Гироскоп

    wasm.onEvent('gyroscopeStarted', () => {
      console.log('Gyroscope started');
    });

    wasm.onEvent('gyroscopeChanged', () => {
      const gyro = wasm.Gyroscope;
      document.getElementById('gyro').textContent =
        `x: ${gyro.x.toFixed(2)}, y: ${gyro.y.toFixed(2)}, z: ${gyro.z.toFixed(2)}`;
    });

    wasm.onEvent('gyroscopeStopped', () => {
      console.log('Gyroscope stopped');
    });

    wasm.onEvent('gyroscopeFailed', (e) => {
      console.error('Gyroscope failed', e.error);
    });

    // Кнопки

    document.getElementById('start').addEventListener('click', () => {
      // Запуск со скоростью 100 мc
      wasm.Accelerometer.start({ refresh_rate: 100 });
      wasm.DeviceOrientation.start({ refresh_rate: 100, need_absolute: false });
      wasm.Gyroscope.start({ refresh_rate: 100 });
    });

    document.getElementById('stop').addEventListener('click', () => {
      wasm.Accelerometer.stop();
      wasm.DeviceOrientation.stop();
      wasm.Gyroscope.stop();
    });
  </script>
</body>
</html>

